@model ERManager.Models.SaleInvoice

@{
    Layout = "_LayoutPrint";
}

<!-- Invoice Content -->
<div dir="rtl" style="background-color:white !important; color:black !important;">
    <div class="card">

        <!-- Header Section -->
        <div style="margin-bottom:-25px !important; padding-bottom:-10px !important;"
             class="card-header bg-primary text-white d-flex justify-content-between align-items-center rounded-lg mb-2 p-3">
            <!-- Reduced margin-bottom -->
            <div>
                <div class="row align-items-center">
                    <h3 class="mb-0">
                        <span>شاکر</span> - <span class="mx-2">9211 233 0770 </span>
                    </h3>
                </div>
                <div  class="row align-items-center">
                    <h3 class="mb-0">
                        <span>دڵزار</span> - <span class="mx-2"> 9463 093 0773  </span>
                    </h3>
                </div>
            </div>
            <div class="text-center">
                <h2 class="mb-0 font-weight-bold">@Model.Contact.Name</h2>
            </div>
            <img src="~/assets/images/LuqmanTechLogo.png" alt="شعار الشركة" height="60">
        </div>


        <!-- Customer and Invoice Info Section -->
        <div style="font-size:22px !important; margin-bottom:-35px !important;" class="row mt-2">
            <!-- Reduced margin-top -->
            <div class="col-12 bg-white p-2">
                <div class="p-3 mb-2 border rounded shadow-sm">

                    <div class="d-flex justify-content-between">
                        <!-- Customer Details -->
                        <div style="width: 45%; padding-right: 20px;">
                            <p class="mb-1">
                                <strong style="display: inline-block; width: 120px;">الاسم:</strong>
                                @Model.Contact.Name
                            </p>
                            <p class="mb-1">
                                <strong style="display: inline-block; width: 120px;">رقم الهاتف:</strong>
                                @Model.Contact.Phone
                            </p>
                        </div>

                        <!-- Invoice Details -->
                        <div style="width: 45%; padding-left: 20px;">
                            <p class="mb-1">
                                <strong style="display: inline-block; width: 120px;">رقم الفاتورة:</strong>
                                @Model.Id
                            </p>
                            <p class="mb-1">
                                <strong style="display: inline-block; width: 120px;">التاریخ:</strong>
                                @Model.CreatedAt?.ToString("yyyy-MM-dd")
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Invoice Items Table -->
        <div class="row mt-3" style="font-size:26px !important; margin-bottom:0px !important;">
            <div class="col-12">
                <div class="table-responsive">
                    <table class="table table-bordered border-dark">
                        <thead class="bg-primary text-white">
                            <tr>
                                <th>نوع</th>
                                <th>وزن</th>
                                <th>سعر</th>
                                <th>عمولە %</th>
                                <th class="text-right">المجموع</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.SaleInvoiceItems)
                            {
                                <tr>
                                    <td class="text-left">@item.Product.Name</td>
                                    <td>@item.Quantity.ToString("N0")</td>
                                    <td>@item.UnitPrice.ToString("N0")</td>
                                    <td>@item.TaxPresent.ToString("N0")</td>
                                    <td class="text-right">@item.LineTotal.ToString("N0")</td>
                                </tr>
                            }
                            <tr>
                                <td>المجموع الکلي</td>
                                <td class="text-danger">@Model.SaleInvoiceItems.Sum(d=>d.Quantity).ToString("N0")</td>
                                <td></td>
                                <td></td>
                                <td style="color:darkgreen">@Model.InvoiceItemsTotal.ToString("N0")</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Invoice Totaling -->
        <div class="d-flex flex-wrap justify-content-between"
             style="font-size: 24px !important; border: 1px solid #dee2e6; border-radius: 5px; padding: 8px; margin-top: -10px !important;">

            <div class="d-flex" style="width: 48%; margin-bottom: 8px; border-bottom: 1px solid #dee2e6; padding-bottom: 8px;">
                <strong class="text-right" style="width: 50%;">سعي:</strong>
                <span class="text-right" style="width: 50%; font-weight: bold; color: #007bff;">@Model.Tax?.ToString("N0")</span>
            </div>

            <div class="d-flex" style="width: 48%; margin-bottom: 8px; border-bottom: 1px solid #dee2e6; padding-bottom: 8px;">
                <strong class="text-right" style="width: 50%;">سلفە سایق:</strong>
                <span class="text-right" style="width: 50%; font-weight: bold; color: #007bff;">@Model.DriverTax?.ToString("N0")</span>
            </div>

            <div class="d-flex" style="width: 48%; margin-bottom: 8px; border-bottom: 1px solid #dee2e6; padding-bottom: 8px;">
                <strong class="text-right" style="width: 50%;">أجرة عامل:</strong>
                <span class="text-right" style="width: 50%; font-weight: bold; color: #007bff;">@Model.EmployeTax?.ToString("N0")</span>
            </div>

            <div class="d-flex" style="width: 48%; margin-bottom: 8px; border-bottom: 1px solid #dee2e6; padding-bottom: 8px;">
                <strong class="text-right" style="width: 50%;">مصرف:</strong>
                <span class="text-right" style="width: 50%; font-weight: bold; color: #007bff;">@Model.Expenses?.ToString("N0")</span>
            </div>

            <div class="d-flex" style="width: 48%; margin-bottom: 8px; border-bottom: 1px solid #dee2e6; padding-bottom: 8px;">
                <strong class="text-right" style="width: 50%;">خصومات:</strong>
                <span class="text-right" style="width: 50%; font-weight: bold; color: #007bff;">@Model.Discount?.ToString("N0")</span>
            </div>

            <div class="d-flex" style="width: 48%; margin-bottom: 8px;">
                <strong class="text-right" style="width: 50%; border-bottom: 1px solid #dee2e6; padding-top: 8px;">المجموع الکلي:</strong>
                <span class="text-right" style="color: darkgreen; font-size: 26px; font-weight: bold; width: 50%; border-bottom: 1px solid #dee2e6; padding-top: 8px;">
                    @Model.InvoiceTotal.ToString("N0")
                </span>
            </div>
        </div>



        <!-- Action Buttons -->
        <div class="d-flex justify-content-start d-print-none mt-4">
            <a href="javascript:window.print()" class="btn btn-primary mr-2"><i class="fas fa-print"></i> طباعة</a>
            <a href="javascript:window.close()" class="btn btn-danger mr-2"><i class="fas fa-times"></i> إغلاق</a>
            <a href="#" class="btn btn-info"><i class="fas fa-paper-plane"></i> إرسال</a>
        </div>

        <!-- Footer Section -->
        <footer style="{position: fixed;bottom: 0px;margin-right: auto;margin-left: auto;}" class="fixed buttom-0 bg-primary text-white mt-4 rounded-lg p-3 text-center font-18" style="padding-top:5px !important;padding-bottom:5px !important;">
            <p class="mb-0">
                <i class="fas fa-map-marker-alt"></i> <strong>العنوان:</strong> السليمانية، علوة &nbsp;|&nbsp;
                <i class="fas fa-calendar-alt"></i> <strong>تاريخ الطباعة:</strong> @DateTime.Now.ToString("yyyy-MM-dd") &nbsp;|&nbsp;
                <i class="fas fa-user"></i> <strong>اسم المستخدم:</strong> @User.Identity.Name
            </p>
        </footer>
    </div>
</div>
@section Scripts {
    <script type="text/javascript">
        document.addEventListener("DOMContentLoaded", function () {
            setTimeout(function () {
                window.print();
            }, 500); // Slight delay to ensure full load
        });
    </script>
}