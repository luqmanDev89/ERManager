@model IEnumerable<ERManager.Models.SaleInvoice>

@{
    ViewData["Title"] = "Profit";
}

<div class="container-fluid">
    <!-- Page title box -->
    <div class="page-title-box">
        <ol class="breadcrumb float-right">
            <li class="breadcrumb-item"><a href="javascript:void(0);">Greeva</a></li>
            <li class="breadcrumb-item"><a href="javascript:void(0);">Reports</a></li>
            <li class="breadcrumb-item active">قازانج</li>
        </ol>
        <h4 class="page-title">ڕاپۆرتی قازانج</h4>
    </div>

    <!-- Summary cards -->
    <div class="row font-13 mb-4">
        <!-- Total Sale -->
        <div class="col-12 col-sm-6 col-md-4 col-lg-2 mb-3">
            <div class="card border-secondary shadow-sm bg-success text-white card-resize">
                <div class="card-body d-flex justify-content-between align-items-center">
                    <div class="text-left">
                        <h5 class="card-title font-weight-bold mb-1">کۆی فڕۆش</h5>
                        <p class="card-text text-dark font-weight-bold display-5 mb-0">@String.Format("{0:N}", ViewBag.totalSale)</p>
                    </div>
                    <i class="fas fa-shopping-cart" style="font-size: 2rem; color: #17a2b8;"></i>
                </div>
            </div>
        </div>
        <!-- Total Tax -->
        <div class="col-12 col-sm-6 col-md-4 col-lg-2 mb-3">
            <div class="card border-secondary shadow-sm bg-info text-white card-resize">
                <div class="card-body d-flex justify-content-between align-items-center">
                    <div class="text-left">
                        <h5 class="card-title font-weight-bold mb-1">کۆی سعی</h5>
                        <p class="card-text font-weight-bold display-5 mb-0">@String.Format("{0:N}", ViewBag.totalTax ?? 0)</p>
                    </div>
                    <i class="fas fa-file-invoice-dollar" style="font-size: 2rem; color: #fff;"></i>
                </div>
            </div>
        </div>
        <!-- Total DriverTax -->
        <div class="col-12 col-sm-6 col-md-4 col-lg-2 mb-3">
            <div class="card border-secondary shadow-sm bg-info text-white card-resize">
                <div class="card-body d-flex justify-content-between align-items-center">
                    <div class="text-left">
                        <h5 class="card-title font-weight-bold mb-1">کۆی کرێی شۆفێر</h5>
                        <p class="card-text font-weight-bold display-5 mb-0">@String.Format("{0:N}", ViewBag.TotalDriverTax ?? 0)</p>
                    </div>
                    <i class="fas fa-file-invoice-dollar" style="font-size: 2rem; color: #fff;"></i>
                </div>
            </div>
        </div>
        <!-- Total EmployeTax -->
        <div class="col-12 col-sm-6 col-md-4 col-lg-2 mb-3">
            <div class="card border-secondary shadow-sm bg-info text-white card-resize">
                <div class="card-body d-flex justify-content-between align-items-center">
                    <div class="text-left">
                        <h5 class="card-title font-weight-bold mb-1">کۆی کرێی کڕیکار</h5>
                        <p class="card-text font-weight-bold display-5 mb-0">@String.Format("{0:N}", ViewBag.totalEmployeTax ?? 0)</p>
                    </div>
                    <i class="fas fa-file-invoice-dollar" style="font-size: 2rem; color: #fff;"></i>
                </div>
            </div>
        </div>
        <!-- Total Cost -->
        <div class="col-12 col-sm-6 col-md-4 col-lg-2 mb-3">
            <div class="card border-secondary shadow-sm bg-danger text-white card-resize">
                <div class="card-body d-flex justify-content-between align-items-center">
                    <div class="text-left">
                        <h5 class="card-title font-weight-bold mb-1">کۆی تێچوو</h5>
                        <p class="card-text font-weight-bold display-5 mb-0">@String.Format("{0:N}", ViewBag.TotalCost)</p>
                    </div>
                    <i class="fas fa-money-bill-wave" style="font-size: 2rem; color: #fff;"></i>
                </div>
            </div>
        </div>
        <!-- Total Cost -->
        <div class="col-12 col-sm-6 col-md-4 col-lg-2 mb-3">
            <div class="card border-secondary shadow-sm bg-danger text-white card-resize">
                <div class="card-body d-flex justify-content-between align-items-center">
                    <div class="text-left">
                        <h5 class="card-title font-weight-bold mb-1">کۆی مەسروف</h5>
                        <p class="card-text font-weight-bold display-5 mb-0">@String.Format("{0:N}", ViewBag.totalExpenses)</p>
                    </div>
                    <i class="fas fa-money-bill-wave" style="font-size: 2rem; color: #fff;"></i>
                </div>
            </div>
        </div>
        <!-- Total Discount -->
        <div class="col-12 col-sm-6 col-md-4 col-lg-2 mb-3">
            <div class="card border-secondary shadow-sm bg-warning text-dark card-resize">
                <div class="card-body d-flex justify-content-between align-items-center">
                    <div class="text-left">
                        <h5 class="card-title font-weight-bold mb-1">کۆی داشکان</h5>
                        <p class="card-text font-weight-bold display-5 mb-0">@String.Format("{0:N}", ViewBag.totalDiscount)</p>
                    </div>
                    <i class="fas fa-tags" style="font-size: 2rem; color: #212529;"></i>
                </div>
            </div>
        </div>
        <!-- Total Profit -->
        <div class="col-12 col-sm-6 col-md-4 col-lg-2 mb-3">
            <div class="card border-secondary shadow-sm bg-success text-white card-resize">
                <div class="card-body d-flex justify-content-between align-items-center">
                    <div class="text-left">
                        <h5 class="card-title font-weight-bold mb-1">کۆی قازانج</h5>
                        <p class="card-text font-weight-bold display-5 mb-0">@String.Format("{0:N}", ViewBag.TotalProfit)</p>
                    </div>
                    <i class="fas fa-dollar-sign" style="font-size: 2rem; color: #fff;"></i>
                </div>
            </div>
        </div>
    </div>


    <!-- Add custom CSS styles -->
    <style>
        /* Ensure cards take up full height of column */
        .card-resize {
            height: 100%;
        }
            /* Adjust inner padding for a consistent look */
            .card-resize .card-body {
                padding: 1.5rem;
            }
    </style>



    <!-- Filter Form -->
    <div class="card-box mb-4">
        <form method="get" id="filterForm">
            <div class="row gx-2 gy-2">
                <div class="col-md-2">
                    <select name="contactId" class="form-control select2" aria-label="Select Contact">
                        <option value="">هەموو پەیوەندیدارەکان</option>
                        @foreach (var contact in ViewBag.Contact as SelectList)
                        {
                            <option value="@contact.Value">@contact.Text</option>
                        }
                    </select>
                </div>
                <div class="col-md-2">
                    <select name="categoryId" class="form-control select2" aria-label="Select Category">
                        <option value="">بەشەکان</option>
                        @foreach (var category in ViewBag.Categories as SelectList)
                        {
                            <option value="@category.Value">@category.Text</option>
                        }
                    </select>
                </div>

                <div class="col-md-2">
                    <input type="date" name="startDate"
                           value="@ViewBag.StartDate?.ToString("yyyy-MM-dd")"
                           class="form-control"
                           placeholder="لە بەرواری" />
                </div>
                <div class="col-md-2">
                    <input type="date" name="endDate"
                           value="@ViewBag.EndDate?.ToString("yyyy-MM-dd")"
                           class="form-control"
                           placeholder="بۆ بەرواری" />
                </div>


                <div class="col-md-1">
                    <input type="number" name="saleInvoiceId"
                           value="@ViewBag.SaleInvoiceId"
                           class="form-control"
                           placeholder="ژ.پسوولە" />
                </div>

                <div class="col-md-2">
                    <input type="text" name="productName"
                           value="@ViewBag.ProductName"
                           class="form-control"
                           placeholder="ناو" />
                </div>
                
                <br />
                <br />
                <div class="col-md-1">
                    <button type="submit" class="btn btn-primary w-100">گەڕان</button>
                </div>
            </div>
        </form>
    </div>


    <!-- Profit Table -->
    <div class="card">
        <div class="card-header text-bold">
            <h4 class="mb-0">لیستی فڕۆشتنەکان</h4>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered table-striped table-hover">
                    <thead class="thead-light">
                        <tr>
                            <th>کۆدی پسوولە</th>
                            <th>کاڵا</th>
                            <th>بەش</th>
                            <th>دانە</th>
                            <th>نرخی کڕین</th>
                            <th>نرخی فڕۆشتن</th>
                            <th>کۆی تێچوو</th>
                            <th>کۆی فڕۆش</th>
                            <th>قازنج</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var invoice in Model) // Iterate over SaleInvoice objects
                        {
                            @foreach (var item in invoice.SaleInvoiceItems) // Iterate over SaleInvoiceItems for each SaleInvoice
                            {
                                <tr>
                                    <td class="text-nowrap">
                                        <a asp-controller="SaleInvoices" asp-action="Edit" asp-route-id="@invoice.Id">
                                            <i class="fas fa-edit"></i> <!-- Edit icon -->
                                            @invoice.Id
                                        </a>
                                    </td>
                                    <td>@item.Product.Name</td>
                                    <td>@item.Product.ProductCategory?.Name</td>
                                    <td>@item.Quantity</td>
                                    <td>@String.Format("{0:N}", item.UnitBuyPrice)</td>
                                    <td>@String.Format("{0:N}", item.UnitPrice)</td>
                                    <td class="text-danger">@String.Format("{0:N}", item.LineBuyTotal)</td>
                                    <td class="text-success">@String.Format("{0:N}", item.LineTotal)</td>
                                    <td class="text-primary">@String.Format("{0:N}", item.Profit)</td>
                                </tr>
                            }
                        }

                    </tbody>
                </table>
            </div>
        </div>
    </div>

</div>
